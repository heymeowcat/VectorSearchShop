<!DOCTYPE html>
<html>
  <head>
    <title>App Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  </head>

  <body>
    <div class="mermaid">
      sequenceDiagram
        participant User
        participant App
        participant CLIPModel
        participant Qdrant
        participant Database
    
        User->>App: Search query (text/image/both)
        App->>CLIPModel: Encode query text/image
        CLIPModel-->>App: Query embeddings
        App->>Qdrant: Search with query embeddings
        Qdrant-->>App: Search results
        App->>Database: Load product data
        Database-->>App: Product data
        App-->>User: Display search results
    
        User->>App: View product details
        App->>CLIPModel: Encode product image
        CLIPModel-->>App: Image embedding
        App->>Qdrant: Search for similar products
        Qdrant-->>App: Similar products
        App-->>User: Display similar products
    
        User->>App: Add new product
        App->>CLIPModel: Encode product text/image
        CLIPModel-->>App: Combined embeddings
        App->>Qdrant: Store combined embeddings
        App->>Database: Store product data
    </div>
    <div class="mermaid">
      graph TD
          subgraph Frontend
              Streamlit
          end

          subgraph Backend
              AppServer[App Server]
              SQLiteDB[SQLite Database]
              QdrantVectorStore[Qdrant Vector Store]
          end

          User[User] -->|Interact| Streamlit
          Streamlit -->|Send Requests| AppServer
          AppServer -->|Read/Write| SQLiteDB
          AppServer -->|Read/Write| QdrantVectorStore
          AppServer -->|Generate Embeddings| CLIPModel

          subgraph Models
              CLIPModel[CLIP Model]
          end

          CLIPModel -->|Provide Embeddings| AppServer

          subgraph External
              HuggingFaceHub[Hugging Face Hub]
          end

          HuggingFaceHub -->|Load Pre-trained Model| CLIPModel

      classDef frontend fill:#f2f2f2,stroke:#333,stroke-width:2px;
      classDef backend fill:#e6e6e6,stroke:#333,stroke-width:2px;
      classDef models fill:#d9d9d9,stroke:#333,stroke-width:2px;
      classDef external fill:#cccccc,stroke:#333,stroke-width:2px;

      class Streamlit frontend;
      class AppServer,SQLiteDB,QdrantVectorStore backend;
      class CLIPModel models;
      class HuggingFaceHub external;
    </div>
    <script>
      mermaid.initialize({
        startOnLoad: true,
        theme: "default",
      });
    </script>
  </body>
</html>
